(function(e){window.Slide=Backbone.Model.extend({defaults:{url:null,sizes:null,alt:null,title:null,link:null,linkTarget:"_blank"}});window.SlideCollection=Backbone.Collection.extend({model:Slide,primary:0,initialize:function(){var e=this;this.on("add",this.addModel,this);this.on("remove",this.removeModel,this);this.on("reset",this.resetData,this);this.on("change",this.resetData,this);setTimeout(function(){_.each(e.models,function(t){e.primary++})})},addModel:function(e){this.primary++;e.set({id:this.primary},{silent:true});this.reset(this.models,{silent:true});this.resetData()},removeModel:function(){var e=this;this.resetIDs();this.reset(this.models,{silent:true});this.resetData()},resetData:function(){e("#slideshow-images").val(JSON.stringify(this))},resetIDs:function(){var e=this;this.primary=0;_.each(this.models,function(t){e.primary++;t.set({id:e.primary},{silent:true})});return this}});window.SlideView=wp.media.View.extend({$container:e(".thumbnails-container .inner"),template:wp.media.template("slide"),initialize:function(){var t=this;this.collection.on("add",this.addThumb,this);this.collection.on("remove",this.render,this);this.collection.on("reset",this.render,this);this.collection.on("change:url",this.render,this);e(".delete-images").bind("click",function(e){e.preventDefault();if(confirm(easingsliderlite.delete_images))t.removeThumbs.call(t,e)});e(".add-image").bind("click",function(e){e.preventDefault();addImageView.render()});e(document).delegate(".delete-button","click",function(n){n.preventDefault();if(confirm(easingsliderlite.delete_image))t.collection.remove(t.collection.get(e(this).parent().attr("data-id")))});e(document).delegate(".thumbnails-container img","click",function(n){n.preventDefault();var r=e(this).parent().attr("data-id"),i=new EditSlideView({model:t.collection.get(r)});e(i.render().el).appendTo("body").focus()})},addThumb:function(e){this.$container.append(this.template(e.toJSON()))},removeThumbs:function(e){e.preventDefault();this.$container.empty();this.collection.reset();this.collection.primary=0},render:function(){var e=this;this.$container.empty();_.each(this.collection.models,function(t){e.$container.append(e.template(t.toJSON()))});return this}});window.EditSlideView=wp.media.View.extend({attributes:{tabindex:0},changeImageView:null,template:wp.media.template("edit-slide"),events:{change:"change","click .media-modal-backdrop, .media-modal-close":"discardChanges","click .change-image":"changeImage","click .media-modal-save":"close","click .media-menu-item":"toggleTab",keydown:"keyDown"},initialize:function(){this.origAttributes=_.clone(this.model.attributes);this.model.on("change:url",this.resetThumbnail,this)},toggleTab:function(t){t.preventDefault();var n=t.target.dataset.tab;e(".media-menu-item").removeClass("active");e(t.target).addClass("active");e(".media-tab",this.$el).each(function(){if(this.id===n)e(this).show();else e(this).hide()})},close:function(e){e.preventDefault();this.remove();if(this.changeImageView)this.changeImageView.remove()},change:function(e){var t=e.target,n={};n[t.id]=t.value;this.model.set(n)},discardChanges:function(e){e.preventDefault();var t=JSON.stringify(this.model.attributes),n=JSON.stringify(this.origAttributes);if(t===n)this.close(e);else{if(confirm(easingsliderlite.media_upload.discard_changes)){this.model.set(this.origAttributes);this.close(e)}}},resetThumbnail:function(e,t){var n=e.get("sizes"),r=n.large||n.medium||n.thumbnail;this.$(".slide-thumbnail").attr("src",r.url)},changeImage:function(t){t.preventDefault();var n=this;if(this.changeImageView===null){this.changeImageView=new ChangeImageView({id:this.model.get("id"),model:this.model})}this.changeImageView.render();e(".media-modal-backdrop").first().hide();this.changeImageView.fileFrame.on("close",function(){e(".media-modal-backdrop").first().show();n.$el.focus()})},keyDown:function(e){if(e.keyCode===27){e.preventDefault();this.discardChanges(e);return}},render:function(){e(this.el).html(this.template(this.model.toJSON()));return this}});window.AddImageView=Backbone.View.extend({fileFrame:null,frameProperties:{title:easingsliderlite.media_upload.title,button:easingsliderlite.media_upload.button,multiple:true},modelAttributes:["url","sizes","alt","title"],initialize:function(){if(this.fileFrame)return;this.fileFrame=wp.media.frames.fileFrame=wp.media({title:this.frameProperties.title,button:{text:this.frameProperties.button},multiple:this.frameProperties.multiple});this.fileFrame.on("select",this.onSelect,this)},onSelect:function(){var e=this.fileFrame.state().get("selection"),t=this;_.each(e.models,function(e){var n={};for(var r in t.modelAttributes)n[t.modelAttributes[r]]=e.get(t.modelAttributes[r]);t.collection.add([n])})},render:function(){this.fileFrame.open()}});window.ChangeImageView=AddImageView.extend({frameProperties:{title:easingsliderlite.media_upload.title,button:easingsliderlite.media_upload.change,multiple:false},onSelect:function(){var e=this.fileFrame.state().get("selection"),t=e.models[0],n={};for(var r in this.modelAttributes)n[this.modelAttributes[r]]=t.get(this.modelAttributes[r]);this.model.set(n)},remove:function(){AddImageView.prototype.remove.apply(this,arguments);this.fileFrame.modal.$el.remove();this.fileFrame.uploader.$browser.remove()}});wp.media.view.Attachment.Details.prototype.template=wp.media.template("media-details");e(".sidebar-name").bind("click",function(){var t=e(this).parent(),n=t.find(".sidebar-content");if(!t.hasClass("exclude")){e(".sidebar-name").each(function(){var t=e(this).parent();if(!t.hasClass("exclude")&&!t.hasClass("closed")){t.find(".sidebar-content").slideUp(200,function(){t.addClass("closed")})}})}if(t.hasClass("closed"))n.slideDown(200,function(){t.removeClass("closed")});else n.slideUp(200,function(){t.addClass("closed")})});e(".thumbnails-container").sortable({items:".thumbnail",containment:"parent",tolerance:"pointer",stop:function(t,n){var r=[],i=[];e(this).find(".thumbnail").each(function(){r.push(e(this).attr("data-id"))});for(var s=0;s<r.length;s++)i.push(slideCollection.get(r[s]));slideCollection.reset(i).resetIDs().resetData()}});setTimeout(function(){e(".message").not(".permanent").each(function(){e(this).fadeOut(400,function(){e(this).remove()})})},5e3);e(".warn").bind("click",function(){if(!confirm(easingsliderlite.warn))return false});if(e("#slideshow-images").length==0)return;window.slideCollection=new SlideCollection(JSON.parse(e("#slideshow-images").val()));window.slideView=new SlideView({collection:slideCollection});window.addImageView=new AddImageView({collection:slideCollection})})(jQuery)